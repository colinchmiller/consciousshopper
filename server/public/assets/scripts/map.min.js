/*! tcs_master 2015-12-18 */
function displayLoading(){$("#spin").addClass("spinner"),$("body").addClass("backgroundSpin")}function displayCompleted(){$("#spin").removeClass("spinner"),$("body").removeClass("backgroundSpin")}var myLatLng={},storesFound=[],storeContent=[];$(document).ready(function(){displayLoading(),$("body").css("overflow","hidden");var a=1;$("#popupButton").click(function(){1==a?($("#navMenu").stop(!0,!1).animate({bottom:150},600),a=0):($("#navMenu").stop(!0,!1).animate({bottom:50},600),a=1)}),getCurrentLocation()});var findStore=function(){console.log("The location data being sent to the db as search criteria: ",myLatLng),$.ajax({type:"GET",url:"/addStore",data:myLatLng,success:function(a){return console.log("The data response from the db: ",a),storesFound=a,console.log("The storesFound: ",storesFound),displayCompleted(),initMap(myLatLng,storesFound),storesFound}})},getCurrentLocation=function(){function a(a,b,c){b.setPosition(c),b.setContent(a?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.")}myLatLng={},navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){myLatLng.lat=parseFloat(a.coords.latitude),myLatLng.lng=parseFloat(a.coords.longitude),console.log("The variable LatLng: ",myLatLng),findStore()}):a(!1,infoWindow,map.getCenter())},initMap=function(a,b){storeContent=[];var c,d,e=new google.maps.InfoWindow,f=new google.maps.Map(document.getElementById("mapContainer"),{zoom:12,center:a,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}}),g=new google.maps.Marker({position:a,map:f,title:"You Are Here"});g.addListener("click",function(){console.log("center")}),console.log("What is the storesFound?: ",b);for(var d=0;d<b.length;d++){console.log("Processing the marker data: ",b[d]);var c=new google.maps.Marker({position:new google.maps.LatLng(b[d].latlong[0],b[d].latlong[1]),map:f,title:b[d].name,icon:"http://maps.google.com/mapfiles/ms/micons/purple-dot.png"}),h=setContentstring(b[d]);storeContent.push(h),console.log("The storeContent is: ",storeContent),google.maps.event.addListener(c,"click",function(a,b){return console.log("click!"),function(){e.setContent(storeContent[b]),e.open(f,a)}}(c,d))}},setContentstring=function(a){var b=(3963.2*a.distance).toFixed(1),c="https://www.google.com/maps/dir/Current+Location/",d=a.latlong[0],e=a.latlong[1],f=c+d+","+e;return contentString='<div class="container"><div class="col-xs-12"><img src="http://www.fillmurray.com/500/400" alt="store logo"/></div><div class="col-xs-12"><h4><a href="store.html"> '+a.name+"</a></h4><h5>"+a.description+"</h5></br><h5><strong>"+b+' Miles</strong></h5><button><a href=" '+f+' ">Directions</a></button></div></div>',contentString};